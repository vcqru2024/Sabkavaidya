"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["default-projects_eav-ui_src_app_shared_components_file-upload-dialog_index_ts"],{3656:(v,C,i)=>{i.d(C,{E:()=>Z});var r=i(600),d=i(4844),E=i(3244),p=i(6560),y=i(604),u=i(5876),O=i(8600),l=i(9432),_=i(1672),g=i(8916),D=i(7496),m=i(6884),f=i(7244),T=i(6028),e=i(4896),I=i(4648),U=i(2720),x=i(1856),A=i(168),M=i(5056),R=i(4204),G=i(4672),w=i(3884),$=i(8200),F=i(48);const b=["installerWindow"];function L(s,n){1&s&&e.wR5(0,"mat-spinner",5)}function B(s,n){1&s&&(e.I0R(0,"div"),e.OEk(1,"Select or drop file"),e.C$Y())}function W(s,n){if(1&s&&(e.I0R(0,"div"),e.OEk(1),e.C$Y()),2&s){const t=n.$implicit;e.yG2(1),e.cNF(t.name)}}function k(s,n){if(1&s){const t=e.KQA();e.I0R(0,"button",14),e.qCj("click",function(){e.usT(t);const o=e.GaO(2);return e.CGJ(o.showAppCatalog())}),e.OEk(1," Get recommended Apps from Catalog "),e.C$Y()}if(2&s){const t=e.GaO();e.E7m("disabled",t.uploading)}}function K(s,n){1&s&&(e.I0R(0,"div",18),e.OEk(1," Upload succeeded. See the messages below for more information. "),e.C$Y())}function Y(s,n){1&s&&(e.I0R(0,"div",19),e.OEk(1," Upload failed. See the messages below for more information. "),e.C$Y())}const S=(s,n,t)=>({"sxc-message-warning":s,"sxc-message-success":n,"sxc-message-error":t});function j(s,n){if(1&s&&(e.I0R(0,"div",20),e.OEk(1),e.C$Y()),2&s){const t=n.$implicit,a=e.GaO(3);e.E7m("ngClass",e.uAc(2,S,t.MessageType===a.FileUploadMessageTypes.Warning,t.MessageType===a.FileUploadMessageTypes.Success,t.MessageType===a.FileUploadMessageTypes.Error)),e.yG2(1),e.oRS(" ",t.Text," ")}}function H(s,n){if(1&s&&(e.I0R(0,"div",15),e.yuY(1,K,2,0,"div",16)(2,Y,2,0,"div",17),e.c53(3,j,2,6,"div",21,e.oxv),e.C$Y()),2&s){const t=e.GaO();e.yG2(1),e.C0Y(1,t.result.Success?1:-1),e.yG2(1),e.C0Y(2,t.result.Success?-1:2),e.yG2(1),e.oho(t.result.Messages)}}function N(s,n){if(1&s&&e.wR5(0,"iframe",24,25),2&s){const t=e.GaO(3);e.E7m("src",t.remoteInstallerUrl,e.CaN)}}function J(s,n){if(1&s&&(e.I0R(0,"div",26),e.wR5(1,"mat-progress-spinner",27),e.I0R(2,"span"),e.OEk(3),e.C$Y()()),2&s){const t=e.GaO(3);e.yG2(1),e.E7m("mode","indeterminate"),e.yG2(2),e.oRS("Installing ",null==t.currentPackage?null:t.currentPackage.displayName,"..")}}function Q(s,n){if(1&s&&e.yuY(0,N,2,1,"iframe",22)(1,J,4,2,"div",23),2&s){const t=e.GaO(2);e.C0Y(0,t.ready?0:-1),e.yG2(1),e.C0Y(1,t.showProgress?1:-1)}}function z(s,n){if(1&s){const t=e.KQA();e.I0R(0,"button",28),e.qCj("click",function(){e.usT(t);const o=e.GaO(2);return e.CGJ(o.closeDialog())}),e.OEk(1,"Cancel"),e.C$Y(),e.I0R(2,"button",29),e.qCj("click",function(){e.usT(t);const o=e.GaO(2);return e.CGJ(o.upload())}),e.OEk(3," Upload "),e.C$Y()}if(2&s){const t=e.GaO();e.yG2(2),e.E7m("disabled",!t.files.length||t.uploading||!!t.result)}}function V(s,n){if(1&s){const t=e.KQA();e.I0R(0,"button",30),e.qCj("click",function(){e.usT(t);const o=e.GaO(2);return e.CGJ(o.closeDialog(!0))}),e.OEk(1,"Close"),e.C$Y()}}function X(s,n){if(1&s){const t=e.KQA();e.I0R(0,"div",1),e.qCj("filesDropped",function(o){e.usT(t);const c=e.GaO();return e.CGJ(c.filesDropped(o))}),e.I0R(1,"div",2),e.wR5(2,"div",3),e.wVc(3,"safeHtml"),e.C$Y(),e.I0R(4,"div",4),e.yuY(5,L,1,0,"mat-spinner",5),e.wR5(6,"p",6),e.wVc(7,"safeHtml"),e.I0R(8,"div")(9,"button",7),e.qCj("click",function(){e.usT(t);const o=e.Gew(14);return e.CGJ(o.click())}),e.yuY(10,B,2,0,"div"),e.c53(11,W,2,1,"div",null,e.oxv),e.C$Y(),e.I0R(13,"input",8,9),e.qCj("change",function(o){e.usT(t);const c=e.GaO();return e.CGJ(c.filesChanged(o))}),e.C$Y(),e.yuY(15,k,2,1,"button",10),e.C$Y(),e.yuY(16,H,5,2,"div",11)(17,Q,2,2),e.C$Y(),e.I0R(18,"mat-dialog-actions",12),e.yuY(19,z,4,1)(20,V,2,0,"button",13),e.C$Y()()}if(2&s){const t=e.GaO();e.E7m("allowedFileTypes",t.dialogData.allowedFileTypes),e.yG2(2),e.E7m("innerHtml",e.kDX(3,11,t.dialogData.title),e.E3n),e.yG2(3),e.C0Y(5,n.uploading?5:-1),e.yG2(1),e.E7m("innerHtml",e.kDX(7,13,t.dialogData.description),e.E3n),e.yG2(3),e.E7m("disabled",n.uploading),e.yG2(1),e.C0Y(10,n.files.length?-1:10),e.yG2(1),e.oho(n.files),e.yG2(4),e.C0Y(15,t.uploadType==t.UploadTypes.App?15:-1),e.yG2(1),e.C0Y(16,n.result?16:-1),e.yG2(1),e.C0Y(17,t.uploadType==t.UploadTypes.App&&n.showAppCatalog?17:-1),e.yG2(2),e.C0Y(19,null!=n.result&&n.result.Success?-1:19),e.yG2(1),e.C0Y(20,null!=n.result&&n.result.Success?20:-1)}}let Z=(()=>{class s extends m.C{constructor(t,a,o,c,P,q,ee,te){super(),this.dialogData=t,this.dialogRef=a,this.snackBar=o,this.installSettingsService=c,this.installerService=P,this.sanitizer=q,this.context=ee,this.changeDetectorRef=te,this.hostClass="dialog-component",this.uploading$=new d.g(!1),this.files$=new d.g([]),this.result$=new d.g(void 0),this.FileUploadMessageTypes=f.c,this.UploadTypes=f.w,this.showAppCatalog$=new d.g(!1),this.showProgress=!1,this.remoteInstallerUrl="",this.ready=!1,this.alreadyProcessing=!1,this.messages$=(0,E.w)(window,"message").pipe((0,p.I)(()=>!this.alreadyProcessing),(0,p.I)(h=>"https://2sxc.org"===h.origin),(0,y.k)(h=>{try{return JSON.parse(h.data)}catch(se){return void console.error("error procesing message. Message was "+h.data,se)}}),(0,p.I)(h=>h&&Number(h.moduleId)===this.context.moduleId)),this.subscription.add(this.installSettingsService.settings$.subscribe(h=>{this.settings=h,this.remoteInstallerUrl=this.sanitizer.bypassSecurityTrustResourceUrl(h.remoteUrl),this.ready=!0}))}ngOnInit(){this.subscription.add(this.files$.subscribe(()=>{void 0!==this.result$.value&&this.result$.next(void 0)})),null!=this.dialogData.files&&this.filesDropped(this.dialogData.files),this.viewModel$=(0,u.E)([this.uploading$,this.files$,this.result$,this.showAppCatalog$]).pipe((0,y.k)(([t,a,o,c])=>({uploading:t,files:a,result:o,showAppCatalog:c}))),this.installSettingsService.loadGettingStarted(!1),this.subscription.add(this.messages$.pipe((0,p.I)(t=>"specs"===t.action),(0,O.y)(()=>{const t=this.installerWindow.nativeElement,a={action:"specs",data:{installedApps:this.settings.installedApps,rules:this.settings.installedApps.map(c=>({target:"guid",appGuid:c.guid,mode:"f",url:""}))}},o=JSON.stringify(a);t.contentWindow.postMessage(o,"*"),console.log("debug: just sent specs message:"+o,a,t)})).subscribe()),this.subscription.add(this.messages$.pipe((0,p.I)(t=>"install"===t.action),(0,y.k)(t=>Object.values(t.packages)),(0,p.I)(t=>{const o=`Do you want to install these packages?\n\n${t.reduce((c,P)=>`${c} - ${P.displayName}\n`,"")}\nThis takes about 10 seconds per package. Don't reload the page while it's installing.`;return confirm(o)}),(0,l.G)(t=>(this.alreadyProcessing=!0,this.showProgress=!0,this.changeDetectorRef.detectChanges(),this.installerService.installPackages(t,a=>this.currentPackage=a))),(0,O.y)(()=>{this.showProgress=!1,this.changeDetectorRef.detectChanges(),alert("Installation complete \u{1f44d}"),window.top.location.reload()}),(0,_.a)(t=>(console.error("Error: ",t),this.showProgress=!1,this.alreadyProcessing=!1,this.changeDetectorRef.detectChanges(),alert(`An error occurred: Package ${this.currentPackage.displayName}\n\n${t.error?.Message??t.error?.message??""}\n\n${t.message}\n\nPlease try again later or check how to manually install content-templates: https://azing.org/2sxc/r/0O4OymoA`),(0,g.of)(t)))).subscribe())}ngOnDestroy(){this.uploading$.complete(),this.files$.complete(),this.result$.complete(),super.ngOnDestroy()}closeDialog(t){this.dialogRef.close(t)}filesDropped(t){this.setFiles(t),this.upload()}filesChanged(t){const o=Array.from(t.target.files);this.setFiles(o)}upload(){this.uploading$.next(!0),this.subscription.add(this.dialogData.upload$(this.files$.value).pipe((0,D.U)(1)).subscribe({next:t=>{this.uploading$.next(!1),this.result$.next(t)},error:()=>{this.uploading$.next(!1),this.result$.next(void 0),this.snackBar.open("Upload failed. Please check console for more information",void 0,{duration:3e3})}}))}showAppCatalog(){this.showAppCatalog$.next(!this.showAppCatalog$.value)}setFiles(t){this.dialogData.multiple||(t=t.slice(0,1)),this.files$.next(t)}static#e=this.\u0275fac=function(a){return new(a||s)(e.GI1(r.sR),e.GI1(r.yI),e.GI1(I.yS),e.GI1(U.C),e.GI1(x.u),e.GI1(A.mI),e.GI1(T.e),e.GI1(e.kD9))};static#t=this.\u0275cmp=e.In1({type:s,selectors:[["app-file-upload-dialog"]],viewQuery:function(a,o){if(1&a&&e.CC$(b,5),2&a){let c;e.wto(c=e.Gqi())&&(o.installerWindow=c.first)}},hostVars:1,hostBindings:function(a,o){2&a&&e.SoX("className",o.hostClass)},inputs:{uploadType:"uploadType"},features:[e.eg9],decls:2,vars:3,consts:[["class","eav-dialog","appDragAndDrop","",3,"allowedFileTypes"],["appDragAndDrop","",1,"eav-dialog",3,"allowedFileTypes","filesDropped"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title",3,"innerHtml"],[1,"eav-dialog-content"],["mode","indeterminate","diameter","20","color","accent"],[3,"innerHtml"],["mat-raised-button","","tippy","Open file browser",3,"disabled","click"],["type","file","multiple","",1,"hide",3,"change"],["fileInput",""],["mat-raised-button","","class","eav-app-catalog-button","tippy","Open app catalog",3,"disabled"],["class","eav-result-container"],["align","end"],["mat-raised-button","","color","accent"],["mat-raised-button","","tippy","Open app catalog",1,"eav-app-catalog-button",3,"disabled","click"],[1,"eav-result-container"],["class","sxc-message sxc-message-info"],["class","sxc-message sxc-message-error"],[1,"sxc-message","sxc-message-info"],[1,"sxc-message","sxc-message-error"],[1,"sxc-message",3,"ngClass"],["class","sxc-message",3,"ngClass"],["class","eav-app-catalog-iframe",3,"src"],["class","eav-progress"],[1,"eav-app-catalog-iframe",3,"src"],["installerWindow",""],[1,"eav-progress"],[3,"mode"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","accent",3,"disabled","click"],["mat-raised-button","","color","accent",3,"click"]],template:function(a,o){if(1&a&&(e.yuY(0,X,21,15,"div",0),e.wVc(1,"async")),2&a){let c;e.C0Y(0,(c=e.kDX(1,1,o.viewModel$))?0:-1,c)}},dependencies:[M.QF,R.cm,G.Gw,r.Yp,w.Q,$.Y,M.a,F.K],styles:[".eav-result-container[_ngcontent-%COMP%]{margin-top:16px}.eav-app-catalog-button[_ngcontent-%COMP%]{margin-left:12px}.eav-app-catalog-iframe[_ngcontent-%COMP%]{margin-top:16px;width:100%;height:500px;border:none}.eav-progress[_ngcontent-%COMP%]{position:absolute;left:0;top:0;height:100%;width:100%;background:#fffc;display:flex;justify-content:center;flex-direction:column;text-align:center}.eav-progress[_ngcontent-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%]{margin:0 auto}.eav-progress[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{line-height:48px}"]})}return s})()},7244:(v,C,i)=>{i.d(C,{c:()=>r,w:()=>d});const r={Warning:0,Success:1,Error:2},d={App:0,AppPart:1,ContentType:2,ContentItem:3,Query:4,View:5}},8288:(v,C,i)=>{i.d(C,{Ev:()=>r.E,cB:()=>d.c,wr:()=>d.w});var r=i(3656),d=i(7244)},3884:(v,C,i)=>{i.d(C,{Q:()=>y});var r=i(4896),d=i(3244),E=i(6884),p=i(4648);let y=(()=>{class u extends E.C{constructor(l,_,g){super(),this.zone=_,this.snackBar=g,this.markStyle="outline",this.allowedFileTypes="",this.filesDropped=new r._w7,this.dropAreaClass="eav-droparea",this.dragClass="eav-dragover",this.timeouts=[],this.element=l.nativeElement}ngOnInit(){this.markStyleClass=`eav-droparea-${this.markStyle}`,this.element.classList.add(this.dropAreaClass,this.markStyleClass),this.zone.runOutsideAngular(()=>{this.subscription.add((0,d.w)(this.element,"dragover").subscribe(l=>{l.preventDefault(),l.stopPropagation(),this.clearTimeouts(),this.element.classList.add(this.dragClass)})),this.subscription.add((0,d.w)(this.element,"dragleave").subscribe(l=>{l.preventDefault(),l.stopPropagation(),this.timeouts.push(window.setTimeout(()=>{this.element.classList.remove(this.dragClass)},50))}))})}ngOnDestroy(){this.clearTimeouts(),this.element.classList.remove(this.dropAreaClass,this.markStyleClass,this.dragClass),super.ngOnDestroy()}onDrop(l){l.preventDefault(),l.stopPropagation(),this.clearTimeouts(),this.element.classList.remove(this.dragClass);let g=Array.from(l.dataTransfer.files);g=this.filterTypes(g,this.allowedFileTypes),g.length>0&&this.filesDropped.emit(g)}clearTimeouts(){for(const l of this.timeouts)clearTimeout(l);this.timeouts=[]}filterTypes(l,_){if(""===_)return l;const g=_.split(",").map(m=>m.toLocaleLowerCase()),D=l.filter(m=>{const f=m.name.lastIndexOf(".");if(f<=0)return!1;const T=m.name.substring(f+1).toLocaleLowerCase();return g.includes(T)});if(l.length!==D.length){const m=this.allowedFileTypes.replace(/\,/g,", ");this.snackBar.open(D.length?"Some files were filtered out. This drop location only accepts file types: "+m:"This drop location only accepts file types: "+m,null,{duration:5e3})}return D}static#e=this.\u0275fac=function(_){return new(_||u)(r.GI1(r.GMv),r.GI1(r.WW2),r.GI1(p.yS))};static#t=this.\u0275dir=r.Sc5({type:u,selectors:[["","appDragAndDrop",""]],hostBindings:function(_,g){1&_&&r.qCj("drop",function(m){return g.onDrop(m)})},inputs:{markStyle:"markStyle",allowedFileTypes:"allowedFileTypes"},outputs:{filesDropped:"filesDropped"},features:[r.eg9]})}return u})()},48:(v,C,i)=>{i.d(C,{K:()=>E});var r=i(4896),d=i(168);let E=(()=>{class p{constructor(u){this.sanitizer=u}transform(u){return this.sanitizer.bypassSecurityTrustHtml(u)}static#e=this.\u0275fac=function(O){return new(O||p)(r.GI1(d.mI,16))};static#t=this.\u0275pipe=r.UTH({name:"safeHtml",type:p,pure:!0})}return p})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/17.04.00/dist/ng-edit/default-projects_eav-ui_src_app_shared_components_file-upload-dialog_index_ts.9bff278a1b0d8f2d.js.map