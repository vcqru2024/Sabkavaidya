(()=>{"use strict";var e={300:(e,t,n)=>{function i(e,...t){}n.d(t,{K:()=>i})},764:(e,t,n)=>{n.d(t,{Gq:()=>s,IV:()=>i,Gk:()=>a,AX:()=>r});const i={mapMarker:'<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="map-marker-alt" class="svg-inline--fa fa-map-marker-alt fa-w-12" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z"></path></svg>'};function s(e,t){return`${e}<style>\n${t}\n</style>`}function a(e){return JSON.parse(e.replace("latitude","lat").replace("longitude","lng"))}function r(e){return JSON.stringify(e).replace("lat","latitude").replace("lng","longitude")}}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,n),a.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{class e{static objectsEqual(e,t){if(null==e||null==t)return e===t;const n=e,i=t,s=Object.keys(n),a=Object.keys(i);return s.length===a.length&&s.every((e=>!!i.hasOwnProperty(e)&&n[e]===i[e]))}static arraysEqual(e,t){return null==e||null==t?e===t:e.length===t.length&&e.every(((n,i)=>e[i]===t[i]))}static getFormChanges(e,t){const n={};for(const i of Object.keys(t)){const s=t[i],a=e[i];this.controlValuesEqual(s,a)||(n[i]=s)}return 0===Object.keys(n).length?void 0:n}static toggleInArray(e,t){const n=t.indexOf(e);-1===n?t.push(e):t.splice(n,1)}static markControlTouched(e){e.touched||(e.markAsTouched(),e.updateValueAndValidity())}static patchControlValue(e,t){e.touched||e.markAsTouched(),e.dirty||this.controlValuesEqual(e.value,t)||e.markAsDirty(),e.patchValue(t)}static controlValuesEqual(e,t){return e===t||!("number"!=typeof e||"number"!=typeof t||!isNaN(e)||!isNaN(t))||!!(Array.isArray(e)&&Array.isArray(t)&&this.arraysEqual(e,t))}static disableControl(e,t){e.disabled!==t&&(t?e.disable():e.enable())}static tryParse(e){try{return JSON.parse(e)}catch{}}static distinct(e,t,n){return n.indexOf(e)===t}static lowercaseInsideSquareBrackets(e){return e.replace(/\[([^\]]+)\]/g,((e,t)=>`[${t.toLowerCase()}]`))}}class t{constructor(e,t,n,i,s,a){this.changeEvent=n,this.eavConfig=s,this.config=a,this.fields=[],this.findFields=/\[.*?\]/gi,this.unwrapField=/[\[\]]/gi,this.subscriptions=[],this.mask=e??"",this.value=e??"",this.model=t,this.fields=this.fieldList(),i&&(this.preClean=i),t&&n&&this.watchAllFields()}resolve(){let t=this.mask;return t.includes("[")&&(t=e.lowercaseInsideSquareBrackets(t),null!=this.eavConfig&&(t=t.replace("[app:appid]",this.eavConfig.appId),t=t.replace("[app:zoneid]",this.eavConfig.zoneId)),null!=this.config&&null!=this.config&&(t=t.replace("[guid]",this.config.entityGuid),t=t.replace("[id]",this.config.entityId.toString())),this.fields.forEach(((e,n)=>{const i=this.model.hasOwnProperty(e)&&this.model[e]&&this.model[e].value?this.model[e].value:"",s=this.preClean(e,i);t=t.replace("["+e.toLowerCase()+"]",s)}))),t}fieldList(){const e=[];if(!this.mask)return e;const t=this.mask.match(this.findFields);return t?t.forEach(((t,n)=>{const i=t.replace(this.unwrapField,"");e.push(i)})):e.push(this.mask),e}preClean(e,t){return t}onChange(){const e=this.resolve();this.value!==e&&this.changeEvent(e),this.value=e}watchAllFields(){this.fields.forEach((e=>{if(!this.model[e])return;const t=this.model[e].valueChanges.subscribe((e=>this.onChange()));this.subscriptions.push(t)}))}destroy(){this.subscriptions.forEach((e=>{e.unsubscribe()}))}}var i=n(300),s=n(764);const a="field-custom-gps-dialog";class r extends HTMLElement{constructor(){super(),(0,i.K)(`${a} constructor called`),this.fieldInitialized=!1}connectedCallback(){if(this.fieldInitialized)return;this.fieldInitialized=!0,(0,i.K)(`${a} connectedCallback called`),this.eventListeners=[],this.innerHTML=(0,s.Gq)('<div class="custom-gps-container">\r\n  <div class="map-info">\r\n    <div class="input-component">\r\n      <label for="lat">Lat:</label>\r\n      <input id="lat" type="number" step="0.001" />\r\n    </div>\r\n    &nbsp;\r\n    <div class="input-component">\r\n      <label for="lng">Lng:</label>\r\n      <input id="lng" type="number" step="0.001" />\r\n    </div>\r\n  </div>\r\n\r\n  <div id="address-mask-container" class="map-info address-mask-container hidden">\r\n    <a id="icon-search" class="btn">\r\n      <i class="material-icons-outlined">search</i>\r\n    </a>\r\n    <span id="formatted-address-container"></span>\r\n  </div>\r\n\r\n  <div id="map" class="map-info__map"></div>\r\n</div>\r\n',".custom-gps-container{display:flex;flex-direction:column;height:100%}.map-info{flex:0 0 32px;display:flex;flex-wrap:wrap;align-items:center;padding:4px;padding-left:14px;border-bottom:1px solid #e1e1e1;background:#fff}.map-info label,.map-info #icon-search{margin-right:8px;display:flex;justify-content:center;align-items:center;font-size:12px;text-transform:uppercase;padding:4px}.map-info #icon-search i{font-size:14px;width:14px;height:14px;font-weight:bold}.map-info input{margin-right:8px;padding:4px 16px;border:none;background:rgba(0,0,0,0);outline:none !important}.address-mask-container{flex-wrap:nowrap}.map-info__map{flex:1 1 auto;width:100%;display:block}.hidden{display:none}.btn{border:1px solid silver;border-radius:4px}.btn:hover{background-color:rgba(69,79,99,.08);cursor:pointer}.input-component{display:flex;background-color:rgba(69,79,99,.08);padding:4px;border-radius:4px 4px 0 0;border-bottom:1px solid silver;margin:8px 0}.input-component:hover{border-bottom:1px solid #002753}"),this.latInput=this.querySelector("#lat"),this.lngInput=this.querySelector("#lng");const e=this.querySelector("#address-mask-container");this.iconSearch=this.querySelector("#icon-search");const n=this.querySelector("#formatted-address-container");this.mapContainer=this.querySelector("#map");const r=this.connector._experimental,o=r.allInputTypeNames.map((e=>e.name));o.includes(this.connector.field.settings.LatField)&&(this.latFieldName=this.connector.field.settings.LatField),o.includes(this.connector.field.settings.LongField)&&(this.lngFieldName=this.connector.field.settings.LongField);const l=this.connector.field.settings.AddressMask||this.connector.field.settings["Address Mask"];this.addressMask=new t(l,r.formGroup.controls,null,null),(0,i.K)(`${a} addressMask:`,l),l&&(e.classList.remove("hidden"),n.innerText=this.addressMask.resolve());const c=r.getSettings("Settings.GoogleMaps.DefaultCoordinates");this.defaultCoordinates={lat:c.Latitude,lng:c.Longitude};const d=r.getSettings("Settings.GoogleMaps.ApiKey").ApiKey;this.connector.loadScript("google",`https://maps.googleapis.com/maps/api/js?key=${d}&callback=Function.prototype`,(()=>{this.mapScriptLoaded()}))}mapScriptLoaded(){(0,i.K)(`${a} mapScriptLoaded called`),this.map=new google.maps.Map(this.mapContainer,{zoom:15,center:this.defaultCoordinates,gestureHandling:"greedy",streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER}}),this.marker=new google.maps.Marker({position:this.defaultCoordinates,map:this.map,draggable:!0}),this.geocoder=new google.maps.Geocoder,this.connector.data.value?this.updateHtml((0,s.Gk)(this.connector.data.value)):this.updateHtml(this.defaultCoordinates);const e=()=>{this.onLatLngInputChange()};this.latInput.addEventListener("change",e),this.lngInput.addEventListener("change",e);const t=()=>{this.autoSelect()};this.iconSearch.addEventListener("click",t),this.eventListeners.push({element:this.latInput,type:"change",listener:e},{element:this.lngInput,type:"change",listener:e},{element:this.iconSearch,type:"click",listener:t}),this.marker.addListener("dragend",(e=>{this.onMarkerDragend(e)}))}updateHtml(e){this.latInput.value=e.lat?.toString()??"",this.lngInput.value=e.lng?.toString()??"",this.map.setCenter(e),this.marker.setPosition(e)}updateForm(e){this.connector.data.update((0,s.AX)(e)),this.latFieldName&&this.connector._experimental.updateField(this.latFieldName,e.lat),this.lngFieldName&&this.connector._experimental.updateField(this.lngFieldName,e.lng)}onLatLngInputChange(){(0,i.K)(`${a} input changed`);const e={lat:this.latInput.value.length>0?parseFloat(this.latInput.value):null,lng:this.lngInput.value.length>0?parseFloat(this.lngInput.value):null};this.updateHtml(e),this.updateForm(e)}autoSelect(){(0,i.K)(`${a} geocoder called`);const e=this.addressMask.resolve();this.geocoder.geocode({address:e},((t,n)=>{if(n===google.maps.GeocoderStatus.OK){const e=t[0].geometry.location,n={lat:e.lat(),lng:e.lng()};this.updateHtml(n),this.updateForm(n)}else alert(`Could not locate address: ${e}`)}))}onMarkerDragend(e){(0,i.K)(`${a} marker changed`);const t={lat:e.latLng.lat(),lng:e.latLng.lng()};this.updateHtml(t),this.updateForm(t)}disconnectedCallback(){(0,i.K)(`${a} disconnectedCallback called`),google?.maps.event.clearInstanceListeners(this.marker),google?.maps.event.clearInstanceListeners(this.map),this.eventListeners.forEach((({element:e,type:t,listener:n})=>{e.removeEventListener(t,n)})),this.addressMask.destroy()}}customElements.get(a)||customElements.define(a,r)})(),(()=>{var e=n(300),t=n(764);const i="field-custom-gps";class s extends HTMLElement{constructor(){super(),(0,e.K)(`${i} constructor called`),this.fieldInitialized=!1}connectedCallback(){if(this.fieldInitialized)return;this.fieldInitialized=!0,(0,e.K)(`${i} connectedCallback called`),this.innerHTML=(0,t.Gq)('<div class="custom-gps-preview">\r\n  <div class="custom-gps-preview__text">\r\n    Lat: <span id="lat-container"></span>, Lng: <span id="lng-container"></span>\r\n  </div>\r\n  <div class="custom-gps-preview__spacer"></div>\r\n  <div id="map-icon-container" class="custom-gps-preview__map-icon"></div>\r\n</div>\r\n',".custom-gps-preview{width:100%;display:flex;align-items:center;position:absolute;top:0;bottom:0;font-size:16px;line-height:20px;margin-bottom:-2px;cursor:pointer}.custom-gps-preview__text{flex-shrink:0;max-width:80%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.custom-gps-preview__spacer{flex-grow:1}.custom-gps-preview__map-icon{flex-shrink:0;margin-right:4px;display:flex;align-items:center;justify-content:center}.custom-gps-preview__map-icon svg{width:20px;height:20px;line-height:20px}"),this.querySelector("#map-icon-container").innerHTML=t.IV.mapMarker,this.latContainer=this.querySelector("#lat-container"),this.lngContainer=this.querySelector("#lng-container"),this.eventListeners=[];const n=()=>{this.expand()};this.addEventListener("click",n),this.eventListeners.push({element:this,type:"click",listener:n});const s=this.connector._experimental.getSettings("Settings.GoogleMaps.DefaultCoordinates");this.defaultCoordinates={lat:s.Latitude,lng:s.Longitude},this.connector.data.value?this.updateHtml((0,t.Gk)(this.connector.data.value)):this.updateHtml(this.defaultCoordinates),this.connector.data.onValueChange((e=>{if(e){const n=(0,t.Gk)(e);this.updateHtml(n)}else this.updateHtml(this.defaultCoordinates)}))}updateHtml(e){this.latContainer.innerText=e.lat?.toString()??"",this.lngContainer.innerText=e.lng?.toString()??""}expand(){this.connector.dialog.open()}disconnectedCallback(){(0,e.K)(`${i} disconnectedCallback called`),this.eventListeners.forEach((({element:e,type:t,listener:n})=>{e.removeEventListener(t,n)}))}}customElements.get(i)||customElements.define(i,s)})()})();
//# sourceMappingURL=https://sources.2sxc.org/17.04.00/system/field-custom-gps/index.js.map