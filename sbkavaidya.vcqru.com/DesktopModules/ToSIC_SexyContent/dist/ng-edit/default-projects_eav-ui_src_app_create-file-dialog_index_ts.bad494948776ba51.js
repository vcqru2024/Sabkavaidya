"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["default-projects_eav-ui_src_app_create-file-dialog_index_ts"],{1048:(j,G,a)=>{a.d(G,{M:()=>A});var u=a(604),D=a(6028),x=a(4896),I=a(1332),g=a(3392);const y="admin/AppFiles/asset";let A=(()=>{class P{constructor(i,r,d){this.http=i,this.context=r,this.dnnContext=d}get(i,r,d){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(y),{params:{appId:this.context.appId,global:r,...this.templateIdOrPath(i,r,d)}}).pipe((0,u.k)(h=>{if("auto"===h.Type.toLocaleLowerCase())switch(h.Extension.toLocaleLowerCase()){case".cs":case".cshtml":h.Type="Razor";break;case".html":case".css":case".js":h.Type="Token"}return h}))}save(i,r,d,h){return this.http.post(this.dnnContext.$2sxc.http.apiUrl(y),d,{params:{appId:this.context.appId,global:r,...this.templateIdOrPath(i,r,h)}})}getAll(i){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/AppFiles"),{params:{appId:this.context.appId,...i&&{mask:i}}}).pipe((0,u.k)(({Files:r})=>(r.forEach(d=>{d.Shared??=!1}),r)))}getWebApis(){return this.getAll("*Controller.cs").pipe((0,u.k)(i=>i.map(d=>{const h=d.Path.lastIndexOf("/"),O=d.Path.lastIndexOf("."),S=d.Path.substring(0,h),K=d.Path.substring(h+1,O);return{path:d.Path,folder:S,name:K,isShared:d.Shared}})))}getWebApiDetails(i){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/ApiExplorer/inspect"),{params:{appId:this.context.appId,zoneId:this.context.zoneId,path:i}})}getPredefinedTemplates(i,r){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/GetTemplates"),{params:{...i&&{purpose:i},...r&&{type:r}}})}getPreview(i,r,d){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/preview"),{params:{appId:this.context.appId,path:i,templateKey:d,global:r}})}create(i,r,d){return this.http.post(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/create"),{},{params:{appId:this.context.appId,global:r,purpose:"auto",path:i,templateKey:d}})}templateIdOrPath(i,r,d){if(/^[0-9]*$/g.test(i)){const h=d.find(O=>O.EntityId?.toString()===i&&O.IsShared===r)?.Path;return{templateId:i,...null!=h&&{path:h}}}return{path:i}}static#t=this.\u0275fac=function(r){return new(r||P)(x.CoB(I.KK),x.CoB(D.e),x.CoB(g.es))};static#e=this.\u0275prov=x.wxM({token:P,factory:P.\u0275fac})}return P})()},5544:(j,G,a)=>{a.d(G,{cE:()=>nt,GW:()=>rt});var u=a(1904),D=a(600),x=a(4844),I=a(5876),g=a(1792),C=a(1484),y=a(604),$=a(8600),b=a(9256),Y=a(5976),w=a(3192),A=a(7456),W=a(3451);var r=a(9432),d=a(8916),h=a(4816),O=a(1048),S=a(8928),K=a(6884),t=a(4896),V=a(5056),J=a(9084),k=a(2536);let Q=(()=>{class o{constructor(e,n){this.matInput=e,this.elementRef=n,this.autofocusSelectValue=!1}ngOnInit(){setTimeout(()=>{this.matInput.focus(),this.toBoolean(this.autofocusSelectValue)&&this.elementRef.nativeElement.setSelectionRange(0,this.matInput.value.length)})}toBoolean(e){if("boolean"==typeof e)return e;if("string"==typeof e){const n=e.toLocaleLowerCase();return"true"===n||"false"!==n&&void 0}return null==e?e:void 0}static#t=this.\u0275fac=function(n){return new(n||o)(t.GI1(k.yi),t.GI1(t.GMv))};static#e=this.\u0275dir=t.Sc5({type:o,selectors:[["","appMatInputAutofocus",""]],inputs:{autofocusSelectValue:"autofocusSelectValue"}})}return o})();var U=a(4672),F=a(244),N=a(7872),X=a(6176),B=a(4204);function H(o,s){if(1&o&&(t.I0R(0,"mat-option",21),t.OEk(1),t.C$Y()),2&o){const e=s.$implicit;t.E7m("value",e),t.yG2(1),t.oRS(" ",e," ")}}function Z(o,s){if(1&o&&(t.I0R(0,"mat-option",21),t.OEk(1),t.C$Y()),2&o){const e=s.$implicit;t.E7m("value",e),t.yG2(1),t.oRS(" ",e," ")}}function _(o,s){if(1&o&&(t.I0R(0,"mat-option",21),t.OEk(1),t.C$Y()),2&o){const e=s.$implicit;t.E7m("value",e.Key),t.yG2(1),t.oRS(" ",e.Name," ")}}function q(o,s){1&o&&(t.I0R(0,"app-field-hint",16),t.OEk(1," This field is required "),t.C$Y()),2&o&&t.E7m("isError",!0)}function tt(o,s){1&o&&t.wR5(0,"mat-spinner",22)(1,"div",23)}const L=o=>({disabled:o});function et(o,s){if(1&o&&(t.I0R(0,"div",24)(1,"label",25),t.OEk(2,"Preview"),t.C$Y()(),t.I0R(3,"pre",26),t.OEk(4),t.C$Y()),2&o){const e=t.GaO();t.yG2(1),t.E7m("ngClass",t.S45(3,L,e.loadingPreview)),t.yG2(2),t.E7m("ngClass",t.S45(5,L,e.loadingPreview)),t.yG2(1),t.cNF(e.preview)}}function ot(o,s){if(1&o&&(t.I0R(0,"div",27),t.OEk(1),t.C$Y()),2&o){const e=t.GaO();t.yG2(1),t.oRS(" ",e.previewError," ")}}function at(o,s){if(1&o){const e=t.KQA();t.I0R(0,"div",1)(1,"div",2)(2,"div",3)(3,"span"),t.OEk(4,"Create"),t.C$Y(),t.I0R(5,"span",4),t.OEk(6),t.C$Y()()(),t.I0R(7,"div",5)(8,"form",6)(9,"div",7)(10,"div",8)(11,"div",9)(12,"mat-form-field",10)(13,"mat-label"),t.OEk(14,"Platform"),t.C$Y(),t.I0R(15,"mat-select",11),t.c53(16,H,2,2,"mat-option",21,t.oxv),t.C$Y()()(),t.I0R(18,"div",9)(19,"mat-form-field",10)(20,"mat-label"),t.OEk(21,"Purpose"),t.C$Y(),t.I0R(22,"mat-select",12),t.c53(23,Z,2,2,"mat-option",21,t.oxv),t.C$Y()()()(),t.I0R(25,"div",13)(26,"mat-form-field",10)(27,"mat-label"),t.OEk(28,"Template"),t.C$Y(),t.I0R(29,"mat-select",14),t.c53(30,_,2,2,"mat-option",21,t.oxv),t.C$Y()()(),t.I0R(32,"div",13)(33,"mat-form-field",10)(34,"mat-label"),t.OEk(35,"Name"),t.C$Y(),t.wR5(36,"input",15),t.C$Y(),t.yuY(37,q,2,1,"app-field-hint",16),t.C$Y()(),t.I0R(38,"div",17),t.yuY(39,tt,2,0),t.I0R(40,"button",18),t.qCj("click",function(){t.usT(e);const m=t.GaO();return t.CGJ(m.closeDialog())}),t.OEk(41,"Cancel"),t.C$Y(),t.I0R(42,"button",19),t.qCj("click",function(){t.usT(e);const m=t.GaO();return t.CGJ(m.confirm())}),t.OEk(43," Create "),t.C$Y()(),t.yuY(44,et,5,7)(45,ot,2,1,"div",20),t.C$Y()()()}if(2&o){const e=t.GaO();t.yG2(6),t.cNF(e.controls.finalName.value||(e.controls.folder.value?e.controls.folder.value.trim()+"/":"")),t.yG2(2),t.E7m("formGroup",e.form),t.yG2(8),t.oho(s.platforms),t.yG2(7),t.oho(s.purposes),t.yG2(7),t.oho(s.templates),t.yG2(7),t.C0Y(37,e.controls.name.touched&&null!=e.controls.name.errors&&e.controls.name.errors.required?37:-1),t.yG2(2),t.C0Y(39,s.loadingPreview?39:-1),t.yG2(3),t.E7m("disabled",!e.form.valid||s.loadingPreview||!s.previewValid),t.yG2(2),t.C0Y(44,s.preview?44:-1),t.yG2(1),t.C0Y(45,!s.loadingPreview&&s.previewError?45:-1)}}let nt=(()=>{class o extends K.C{constructor(e,n,m){super(),this.dialogData=e,this.dialogRef=n,this.sourceService=m,this.hostClass="dialog-component",this.all="All"}ngOnInit(){this.templates$=new x.g([]),this.loadingPreview$=new x.g(!1),this.buildForm(),this.fetchTemplates(),this.buildViewModel()}ngOnDestroy(){this.templates$.complete(),this.loadingPreview$.complete(),super.ngOnDestroy()}closeDialog(e){this.dialogRef.close(e)}confirm(){const e=this.form.getRawValue();this.closeDialog({name:e.finalName,templateKey:e.templateKey})}fetchTemplates(){this.sourceService.getPredefinedTemplates(this.dialogData.purpose,this.dialogData.type).subscribe(e=>{this.controls.templateKey.value!==e.Default&&this.controls.templateKey.patchValue(e.Default),this.templates$.next(e.Templates)})}buildForm(){this.form=new u.k1({platform:new u.yM(this.all),purpose:new u.yM({value:this.dialogData.purpose??this.all,disabled:null!=this.dialogData.purpose}),templateKey:new u.yM(null,u.AQ.required),name:new u.yM(this.dialogData.name??null,u.AQ.required),finalName:new u.yM({value:null,disabled:!0}),folder:new u.yM({value:this.dialogData.folder??"",disabled:!0})}),this.controls=this.form.controls,this.subscription.add((0,I.E)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,g.W)(this.controls.templateKey.value),(0,C.a)())]).subscribe(([e,n])=>{const m=e.find(p=>p.Key===n),f=this.dialogData.name?this.controls.name.value||this.dialogData.name:m?.SuggestedFileName??null;this.controls.name.value!==f&&this.controls.name.patchValue(f)})),this.subscription.add((0,I.E)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,g.W)(this.controls.templateKey.value),(0,C.a)()),this.controls.name.valueChanges.pipe((0,g.W)(this.controls.name.value),(0,C.a)()),this.controls.folder.valueChanges.pipe((0,g.W)(this.controls.folder.value),(0,C.a)())]).subscribe(([e,n,m,f])=>{const p=e.find(c=>c.Key===n);let l=null;m&&(f=f.trim(),m=S.YH.sanitizePath(m.trim()),l=`${f?`${f}/`:""}${m=`${p?.Prefix??""}${m}${p?.Suffix??""}${p?.Extension??""}`}`.replace(/\/{2,}/g,"/")),this.controls.finalName.value!==l&&this.controls.finalName.patchValue(l)}))}buildViewModel(){const e=this.templates$.pipe((0,y.k)(p=>{const l={[this.all]:this.all};return p.forEach(c=>{c.Platforms?.forEach(v=>{l[v]=v})}),Object.keys(l)})),n=this.templates$.pipe((0,y.k)(p=>{const l={[this.all]:this.all};return p.forEach(c=>{l[c.Purpose]=c.Purpose}),Object.keys(l)})),m=(0,I.E)([this.templates$,this.controls.platform.valueChanges.pipe((0,g.W)(this.controls.platform.value),(0,C.a)()),this.controls.purpose.valueChanges.pipe((0,g.W)(this.controls.purpose.value),(0,C.a)())]).pipe((0,y.k)(([p,l,c])=>p.filter(M=>(l===this.all||(M.Platforms?.includes(l)??!1))&&(c===this.all||M.Purpose===c))),(0,$.y)(p=>{if(!p.some(l=>l.Key===this.controls.templateKey.value)){const l=p[0]?.Key??null;this.controls.templateKey.value!==l&&this.controls.templateKey.patchValue(l)}})),f=(0,I.E)([this.controls.finalName.valueChanges.pipe((0,g.W)(this.controls.finalName.value),(0,C.a)()),this.controls.templateKey.valueChanges.pipe((0,g.W)(this.controls.templateKey.value),(0,C.a)())]).pipe(function i(o,s=b.M,e){const n=(0,W.k)(o,s);return function P(o,s){return(0,Y.i)((e,n)=>{const{leading:m=!0,trailing:f=!1}=s??{};let p=!1,l=null,c=null,v=!1;const M=()=>{c?.unsubscribe(),c=null,f&&(z(),v&&n.complete())},R=()=>{c=null,v&&n.complete()},T=E=>c=(0,A.Uv)(o(E)).subscribe((0,w.e)(n,M,R)),z=()=>{if(p){p=!1;const E=l;l=null,n.next(E),!v&&T(E)}};e.subscribe((0,w.e)(n,E=>{p=!0,l=E,(!c||c.closed)&&(m?z():T(E))},()=>{v=!0,(!(f&&p&&c)||c.closed)&&n.complete()}))})}(()=>n,e)}(100,b.M,{leading:!0,trailing:!0}),(0,$.y)(()=>{this.loadingPreview$.next(!0)}),(0,r.G)(([p,l])=>p&&l?(0,h.y)([this.sourceService.getPreview(p,this.dialogData.global,l),(0,W.k)(500)]).pipe((0,y.k)(([c])=>c)):(0,d.of)(void 0)),(0,$.y)(()=>{this.loadingPreview$.next(!1)}));this.viewModel$=(0,I.E)([e,n,m,f,this.loadingPreview$]).pipe((0,y.k)(([p,l,c,v,M])=>({platforms:p,purposes:l,templates:c,loadingPreview:M,preview:v?.Preview,previewValid:v?.IsValid??!1,previewError:v?.Error})))}static#t=this.\u0275fac=function(n){return new(n||o)(t.GI1(D.sR),t.GI1(D.yI),t.GI1(O.M))};static#e=this.\u0275cmp=t.In1({type:o,selectors:[["app-create-file-dialog"]],hostVars:1,hostBindings:function(n,m){2&n&&t.SoX("className",m.hostClass)},features:[t.eg9],decls:2,vars:3,consts:[["class","eav-dialog eav-no-scrollbar"],[1,"eav-dialog","eav-no-scrollbar"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title","eav-dialog-title-box"],[1,"eav-file-name"],[1,"eav-dialog-content"],[1,"dialog-form",3,"formGroup"],[1,"dialog-form-content"],[1,"eav-field-container","eav-multiple"],[1,"eav-multiple-field"],["color","accent",1,"eav-form-field"],["formControlName","platform"],["formControlName","purpose"],[1,"eav-field-container"],["formControlName","templateKey"],["matInput","","type","text","formControlName","name","required","","appMatInputAutofocus","","autofocusSelectValue","true"],[3,"isError"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"disabled","click"],["class","eav-preview-error"],[3,"value"],["mode","indeterminate","diameter","20","color","accent"],[1,"spacer"],[1,"eav-preview-label-box"],[1,"eav-preview-label",3,"ngClass"],[1,"fancy-scrollbar-light",3,"ngClass"],[1,"eav-preview-error"]],template:function(n,m){if(1&n&&(t.yuY(0,at,46,7,"div",0),t.wVc(1,"async")),2&n){let f;t.C0Y(0,(f=t.kDX(1,1,m.viewModel$))?0:-1,f)}},dependencies:[V.QF,J.o,Q,U.Gw,F.Up,F.w5,N.kX,X.I5,u.sz,u.ot,u.ue,u.u,u.eJ,u.uW,u.Wo,k.yi,B.cm,V.a],styles:[".eav-dialog-title-box[_ngcontent-%COMP%]{white-space:nowrap}.eav-dialog-title-box[_ngcontent-%COMP%]   .eav-file-name[_ngcontent-%COMP%]{font-size:20px;margin-left:8px;background-color:#d3d3d3}.eav-field-container[_ngcontent-%COMP%]:not(:first-of-type){margin-top:8px}.eav-field-container.eav-multiple[_ngcontent-%COMP%]{display:flex}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]{flex:1}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]:not(:first-of-type){margin-left:8px}.dialog-form-content[_ngcontent-%COMP%], .dialog-form-actions[_ngcontent-%COMP%]{flex-shrink:0}pre[_ngcontent-%COMP%]{flex-grow:1;flex-shrink:1;font-family:monospace}pre.disabled[_ngcontent-%COMP%]{color:#1d273d3d}.eav-preview-label-box[_ngcontent-%COMP%]{position:relative}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label[_ngcontent-%COMP%]{position:absolute;top:-20px;left:0;font-size:12px;color:#0009;pointer-events:none}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label.disabled[_ngcontent-%COMP%]{color:#1d273d70}.eav-preview-error[_ngcontent-%COMP%]{margin-bottom:10px;font-size:14px;color:red}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}"]})}return o})();var it=a(6028),lt=a(988),st=a(8512);let rt=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275mod=t.a4G({type:o});static#o=this.\u0275inj=t.s3X({providers:[it.e,O.M,{provide:F.uY,useValue:{subscriptSizing:"dynamic"}},{provide:N.kF,useValue:{hideSingleSelectionIndicator:!0}}],imports:[V.MD,lt.q,U.oJ,N.d5,u.sl,F.wb,k.cN,B.kB,st.NR]})}return o})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/17.04.00/dist/ng-edit/default-projects_eav-ui_src_app_create-file-dialog_index_ts.bad494948776ba51.js.map